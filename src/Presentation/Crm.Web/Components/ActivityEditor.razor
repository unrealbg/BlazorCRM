@using Crm.Application.Services
@using Crm.Domain.Enums
@using Microsoft.AspNetCore.Identity

<Modal @ref="_modal" Title="@(_id == Guid.Empty ? "New activity" : "Edit activity")">
  <EditForm Model="this" OnValidSubmit="SaveAsync">
    <DataAnnotationsValidator />
    <ValidationSummary />
    <div class="grid grid-cols-1 md:grid-cols-5 gap-2">
      <select class="select" @bind="_type">
        @foreach (var t in Enum.GetValues<ActivityType>())
        {
          <option value="@t.ToString()">@t</option>
        }
      </select>
      <input class="input" type="datetime-local" @bind-value="_dueLocal" @bind-value:event="oninput" />
      <select class="select" @bind="_status">
        @foreach (var s in Enum.GetValues<ActivityStatus>())
        {
          <option value="@s.ToString()">@s</option>
        }
      </select>
      <select class="select" @bind="_owner">
        <option value="">Unassigned</option>
        @foreach (var u in _users)
        {
          <option value="@u.Id">@DisplayName(u)</option>
        }
      </select>
      <input class="input md:col-span-2" placeholder="Notes" @bind="_notes" required />
    </div>
    <div class="mt-3 flex justify-between gap-2">
      <div>
        @if (_id != Guid.Empty)
        {
          <button type="button" class="btn text-rose-500" @onclick="AskDelete">Delete</button>
        }
      </div>
      <div class="flex gap-2">
        <button type="button" class="btn btn-muted" @onclick="() => _modal.Hide()">Cancel</button>
        <button class="btn btn-primary">Save</button>
      </div>
    </div>
  </EditForm>
</Modal>

<ConfirmModal @ref="_confirm" Title="Delete activity" Message="Are you sure you want to delete this activity?" OnConfirmed="ConfirmDeleteAsync" />


